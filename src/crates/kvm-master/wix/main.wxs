<?xml version="1.0" encoding="UTF-8"?>
<!--
  KVM-Over-IP Master - Windows MSI Installer (WiX v4)
  Installs kvm-master.exe to C:\Program Files\KVM-Over-IP\
  with Start Menu and optional Desktop shortcuts.
-->
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">

  <Package Name="KVM-Over-IP Master"
           Manufacturer="KVM-Over-IP Project"
           Version="0.1.0"
           UpgradeCode="A1B2C3D4-E5F6-7890-ABCD-EF1234567890"
           Language="1033"
           Codepage="1252">

    <!-- Allow upgrading from previous versions cleanly -->
    <MajorUpgrade DowngradeErrorMessage="A newer version is already installed." />

    <!-- Use the standard WiX feature-tree UI (Welcome, License, Features, Install) -->
    <ui:WixUI Id="WixUI_FeatureTree" />
    <WixVariable Id="WixUILicenseRtf" Value="wix\License.rtf" />

    <!-- Define where files are installed -->
    <StandardDirectory Id="ProgramFilesFolder">
      <Directory Id="INSTALLDIR" Name="KVM-Over-IP">
        <Component Id="MainExecutable" Guid="B2C3D4E5-F6A7-8901-BCDE-F12345678901">
          <!-- The main executable - copied to install directory -->
          <File Id="FileKvmMaster"
                Source="kvm-master.exe"
                KeyPath="yes" />
        </Component>
      </Directory>
    </StandardDirectory>

    <!-- Start Menu shortcut -->
    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ApplicationProgramsFolder" Name="KVM-Over-IP">
        <Component Id="StartMenuShortcut" Guid="C3D4E5F6-A7B8-9012-CDEF-123456789012">
          <Shortcut Id="StartMenuShortcutEntry"
                    Name="KVM-Over-IP Master"
                    Description="Control keyboard and mouse across multiple computers"
                    Target="[INSTALLDIR]kvm-master.exe"
                    WorkingDirectory="INSTALLDIR" />
          <RemoveFolder Id="RemoveProgramsFolder" On="uninstall" />
          <RegistryValue Root="HKCU"
                         Key="Software\KVMOverIP\Master"
                         Name="installed"
                         Type="integer"
                         Value="1"
                         KeyPath="yes" />
        </Component>
      </Directory>
    </StandardDirectory>

    <!-- Optional Desktop shortcut (selected by default) -->
    <StandardDirectory Id="DesktopFolder">
      <Component Id="DesktopShortcut" Guid="D4E5F6A7-B8C9-0123-DEF0-234567890123">
        <Shortcut Id="DesktopShortcutEntry"
                  Name="KVM-Over-IP Master"
                  Description="Control keyboard and mouse across multiple computers"
                  Target="[INSTALLDIR]kvm-master.exe"
                  WorkingDirectory="INSTALLDIR" />
        <RegistryValue Root="HKCU"
                       Key="Software\KVMOverIP\Master"
                       Name="desktop"
                       Type="integer"
                       Value="1"
                       KeyPath="yes" />
      </Component>
    </StandardDirectory>

    <!-- Feature tree: Core (required) + Desktop shortcut (optional) -->
    <Feature Id="ProductFeature" Title="KVM-Over-IP Master" Level="1">
      <ComponentRef Id="MainExecutable" />
      <ComponentRef Id="StartMenuShortcut" />
    </Feature>

    <Feature Id="DesktopFeature" Title="Desktop Shortcut" Level="1">
      <ComponentRef Id="DesktopShortcut" />
    </Feature>

  </Package>
</Wix>
